<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìó Student Scores</title>
    <style>
      :root {
        --bg-color: #1d1c1f;
        --text-color: #fdfdfd;
      }

      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
      }

      body {
        width: 100vw;
        min-height: 100vh;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: var(--bg-color);
        color: var(--text-color);
      }

      h1 {
        padding: 20px 0;
      }

      .wrapper {
        width: fit-content;
        display: flex;
        flex-direction: column;
      }

      .container {
        display: flex;
        flex-direction: column;
      }

      .row {
        display: flex;
        align-items: center;
      }

      .cell {
        width: 120px;
        height: 40px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <script>
      /**
       * Random data * over 40 rows (class, gender, name, score - kor, eng, math)
       */
      const dataFrame = [
        [1, "Ïó¨", "Ï†ïÏÑúÏó∞", 97, 90, 92],
        [1, "Ïó¨", "ÍπÄÎèÑÏú§", 54, 80, 76],
        [3, "ÎÇ®", "Ï†ïÏßÄÏö∞", 90, 11, 50],
        [3, "Ïó¨", "Î∞ïÏòàÏ§Ä", 82, 88, 68],
        [4, "ÎÇ®", "Î∞ïÏÑúÏó∞", 14, 56, 98],
        [3, "ÎÇ®", "ÏµúÎØºÏ§Ä", 52, 61, 85],
        [4, "Ïó¨", "Î∞ïÏÑúÏó∞", 15, 18, 42],
        [2, "ÎÇ®", "Ïù¥ÎØºÏ§Ä", 90, 97, 98],
        [3, "ÎÇ®", "ÏµúÎØºÏ§Ä", 51, 81, 64],
        [2, "ÎÇ®", "Ïù¥ÎØºÏ§Ä", 86, 40, 90],
        [4, "Ïó¨", "ÏµúÎèÑÏú§", 99, 90, 16],
        [4, "Ïó¨", "ÍπÄÎèÑÏú§", 93, 17, 98],
        [1, "ÎÇ®", "ÏµúÎØºÏ§Ä", 14, 58, 54],
        [2, "Ïó¨", "Î∞ïÎèÑÏú§", 57, 16, 13],
        [1, "Ïó¨", "ÍπÄÏòàÎ¶∞", 90, 97, 21],
        [1, "Ïó¨", "ÏµúÌïòÏú§", 61, 69, 82],
        [1, "ÎÇ®", "Ïù¥ÏßÄÏö∞", 96, 31, 35],
        [4, "Ïó¨", "Ï†ïÏÑúÏó∞", 97, 27, 35],
        [2, "Ïó¨", "ÍπÄÎèÑÏú§", 54, 80, 76],
        [2, "ÎÇ®", "Ï†ïÏßÄÏö∞", 90, 11, 50],
        [2, "Ïó¨", "Î∞ïÏòàÏ§Ä", 82, 88, 68],
        [4, "ÎÇ®", "Î∞ïÏÑúÏó∞", 14, 56, 98],
        [3, "Ïó¨", "ÏµúÎØºÏ§Ä", 52, 61, 85],
        [4, "Ïó¨", "Î∞ïÏÑúÏó∞", 15, 18, 42],
        [3, "Ïó¨", "Ïù¥ÎØºÏ§Ä", 90, 97, 98],
        [1, "ÎÇ®", "ÏµúÎØºÏ§Ä", 51, 81, 64],
        [3, "ÎÇ®", "Ïù¥ÎØºÏ§Ä", 86, 40, 90],
        [4, "ÎÇ®", "ÏµúÎèÑÏú§", 99, 90, 16],
        [3, "ÎÇ®", "ÍπÄÎèÑÏú§", 93, 17, 98],
        [2, "ÎÇ®", "ÏµúÎØºÏ§Ä", 14, 58, 54],
        [2, "Ïó¨", "Î∞ïÎèÑÏú§", 57, 16, 13],
        [2, "Ïó¨", "ÍπÄÏòàÎ¶∞", 90, 97, 21],
        [2, "ÎÇ®", "ÏµúÌïòÏú§", 61, 69, 82],
        [1, "Ïó¨", "Ïù¥ÏßÄÏö∞", 96, 31, 35],
        [4, "Ïó¨", "Ï†ïÏÑúÏó∞", 97, 27, 35],
        [2, "Ïó¨", "ÍπÄÎèÑÏú§", 54, 80, 76],
        [3, "ÎÇ®", "Ï†ïÏßÄÏö∞", 90, 11, 50],
        [1, "Ïó¨", "Î∞ïÏòàÏ§Ä", 82, 88, 68],
        [4, "ÎÇ®", "Î∞ïÏÑúÏó∞", 99, 56, 98],
        [3, "ÎÇ®", "ÏµúÎØºÏ§Ä", 52, 61, 85],
        [1, "Ïó¨", "Î∞ïÏÑúÏó∞", 15, 18, 42],
        [3, "ÎÇ®", "Ïù¥ÎØºÏ§Ä", 90, 97, 98],
        [2, "ÎÇ®", "ÏµúÎØºÏ§Ä", 51, 81, 64],
        [3, "ÎÇ®", "Ïù¥ÎØºÏ§Ä", 86, 70, 90],
        [4, "Ïó¨", "ÏµúÎèÑÏú§", 99, 90, 16],
        [4, "Ïó¨", "ÍπÄÎèÑÏú§", 93, 17, 98],
        [2, "ÎÇ®", "ÏµúÎØºÏ§Ä", 14, 58, 54],
        [2, "ÎÇ®", "Î∞ïÎèÑÏú§", 57, 16, 13],
        [1, "Ïó¨", "ÍπÄÏòàÎ¶∞", 90, 97, 21],
        [2, "ÎÇ®", "ÏµúÌïòÏú§", 61, 69, 82],
        [1, "ÎÇ®", "Ïù¥ÏßÄÏö∞", 96, 99, 35],
      ];

      /**
       * Append sum and average
       */
      for (const row of dataFrame) {
        // Get entire scores and return result of sum and average
        const kor = row[3];
        const eng = row[4];
        const math = row[5];

        const sum = kor + eng + math;
        const average = sum / 3;
        row.push(sum, Number(average.toFixed(2)));
      }

      /**
       * Set the grade of each average
       */

      for (const row of dataFrame) {
        const average = row[row.length - 1];

        let grade = ""; // ex) [grade, color]

        // Grade standard (score >= 90 - 'Ïàò', score >= 80 - 'Ïö∞'... etc.)
        if (average >= 90) {
          grade = "Ïàò";
        } else if (average >= 80) {
          grade = "Ïö∞";
        } else if (average >= 70) {
          grade = "ÎØ∏";
        } else if (average >= 60) {
          grade = "Ïñë";
        } else {
          grade = "Í∞Ä";
        }

        row.push(grade[0]);
      }

      // Define colors
      const colors = [
        "oklch(69.2% 0.201 14.57)",
        "oklch(71.5% 0.182 37.72)",
        "oklch(83.6% 0.149 77.04)",
        "oklch(86.7% 0.179 132.04)",
        "oklch(82.5% 0.088 257.57)",
      ];

      /**
       * 1. Entire students output
       */

      // Entire contents will be appended.
      let contents = "";

      const title1 = `<h1>1. ÏûÖÎ†• ÏàúÏÑú</h1>`;
      contents += title1;

      const headerText = [
        "Î∞ò",
        "ÏÑ±Î≥Ñ",
        "Ïù¥Î¶Ñ",
        "Íµ≠Ïñ¥",
        "ÏòÅÏñ¥",
        "ÏàòÌïô",
        "Ï¥ùÏ†ê",
        "ÌèâÍ∑†",
        "Îì±Í∏â",
      ];

      let header = "";
      for (const text of headerText) {
        header += `<div class='cell'>${text}</div>`;
      }

      contents += `<div class='row'>${header}</div>`;

      //
      let rowText = "";

      for (const row of dataFrame) {
        let cell = "";
        for (const element of row) {
          let color = "";

          const grade = row[row.length - 1];

          switch (grade) {
            case "Ïàò":
              color = colors[0];
              break;
            case "Ïö∞":
              color = colors[1];
              break;
            case "ÎØ∏":
              color = colors[2];
              break;
            case "Ïñë":
              color = colors[3];
              break;
            default:
              color = colors[4];
          }

          const isElementGrade = grade === element;

          cell += `
            <div 
              class='cell' 
              style='color: ${isElementGrade ? color : "var(--text-color)"}'
            >
              ${element}
            </div>
          `;
        }
        rowText += `<div class='row'>${cell}</div>`;
      }

      const container = `<div class='container'>${rowText}</div>`;
      contents += container;

      /**
       * 3. Sort rank by gender
       */
      const title3 = "<h1>2. Î∞òÎ≥Ñ Îì±Ïàò</h1>";
      contents += title3;

      headerText.push("Îì±Ïàò");
      header = "";
      for (const text of headerText) {
        header += `<div class='cell'>${text}</div>`;
      }

      contents += `<div class='row'>${header}</div>`;

      const classA = [];
      const classB = [];
      const classC = [];
      const classD = [];

      for (const row of dataFrame) {
        switch (row[0]) {
          case 1:
            classA.push(row);
            break;
          case 2:
            classB.push(row);
            break;
          case 3:
            classC.push(row);
            break;
          default:
            classD.push(row);
        }
      }

      // Bind classes as a group and iterate.
      const classGroup = [classA, classB, classC, classD];

      for (const pickedClass of classGroup) {
        lastSortedCount = 1;

        for (i = 0; i < pickedClass.length - 1; i++) {
          for (j = 0; j < pickedClass.length - lastSortedCount; j++) {
            let currentRowAverage = pickedClass[j][7];
            let nextRowAverage = pickedClass[j + 1][7];

            if (nextRowAverage > currentRowAverage) {
              let temp = pickedClass[j + 1];
              pickedClass[j + 1] = pickedClass[j];
              pickedClass[j] = temp;
            }
          }

          lastSortedCount++;
        }
      }

      // UI mapping
      for (const pickedClass of classGroup) {
        let rank = 1; // Rank will be initialized when class is changed
        let rowText = "";

        for (const row of pickedClass) {
          row.push(rank);

          let cell = "";
          for (const element of row) {
            let color = "";

            const grade = row[8];

            switch (grade) {
              case "Ïàò":
                color = colors[0];
                break;
              case "Ïö∞":
                color = colors[1];
                break;
              case "ÎØ∏":
                color = colors[2];
                break;
              case "Ïñë":
                color = colors[3];
                break;
              default:
                color = colors[4];
            }

            const isElementGrade = grade === element;

            cell += `
              <div 
                class='cell' 
                style='color: ${isElementGrade ? color : "var(--text-color)"}'
              >
                ${element}
              </div>
            `;
          }

          rowText += `<div class='row'>${cell}</div>`;
          rank++;
        }
        let container = `<div class='container'>${rowText}</div>`;
        contents += container;
      }

      /**
       * 5. Seperate by classes, and grouping by gender.
       */
      const title5 = "<h1>Î∞òÏÑ±Î≥ÑÎ≥Ñ Îì±Ïàò</h1>";
      contents += title5;

      header = "";
      for (const text of headerText) {
        header += `<div class='cell'>${text}</div>`;
      }

      contents += `<div class='row'>${header}</div>`;

      for (let pickedClass of classGroup) {
        maleGroup = [];
        femaleGroup = [];

        for (const row of pickedClass) {
          row.splice(-1); // Delete existing rank for recalculate.
          row[1] === "ÎÇ®" ? maleGroup.push(row) : femaleGroup.push(row);
        }

        // Bubble sort by rank of each group
        for (i = 0; i < maleGroup.length - 1; i++) {
          for (j = 0; j < maleGroup.length - lastSortedCount; j++) {
            let currentRowAverage = maleGroup[j][7];
            let nextRowAverage = maleGroup[j + 1][7];

            if (nextRowAverage > currentRowAverage) {
              let temp = maleGroup[j + 1];
              maleGroup[j + 1] = maleGroup[j];
              maleGroup[j] = temp;
            }
          }

          lastSortedCount++;
        }

        // Initialize
        lastSortedCount = 1;

        for (i = 0; i < femaleGroup.length - 1; i++) {
          for (j = 0; j < femaleGroup.length - lastSortedCount; j++) {
            let currentRowAverage = femaleGroup[j][7];
            let nextRowAverage = femaleGroup[j + 1][7];

            if (nextRowAverage > currentRowAverage) {
              let temp = femaleGroup[j + 1];
              femaleGroup[j + 1] = femaleGroup[j];
              femaleGroup[j] = temp;
            }
          }

          lastSortedCount++;
        }

        let rank = 1;
        let rowText = "";

        // UI mapping
        for (const row of maleGroup) {
          row.push(rank);

          let cell = "";
          for (const element of row) {
            let color = "";

            const grade = row[8];

            switch (grade) {
              case "Ïàò":
                color = colors[0];
                break;
              case "Ïö∞":
                color = colors[1];
                break;
              case "ÎØ∏":
                color = colors[2];
                break;
              case "Ïñë":
                color = colors[3];
                break;
              default:
                color = colors[4];
            }

            const isElementGrade = grade === element;

            cell += `
              <div 
                class='cell' 
                style='color: ${isElementGrade ? color : "var(--text-color)"}'
              >
                ${element}
              </div>
            `;
          }

          rowText += `<div class='row'>${cell}</div>`;
          rank++;
        }

        // Re-initialize rank for female group
        rank = 1;

        for (const row of femaleGroup) {
          row.push(rank);

          let cell = "";
          for (const element of row) {
            let color = "";

            const grade = row[8];

            switch (grade) {
              case "Ïàò":
                color = colors[0];
                break;
              case "Ïö∞":
                color = colors[1];
                break;
              case "ÎØ∏":
                color = colors[2];
                break;
              case "Ïñë":
                color = colors[3];
                break;
              default:
                color = colors[4];
            }

            const isElementGrade = grade === element;

            cell += `
              <div 
                class='cell' 
                style='color: ${isElementGrade ? color : "var(--text-color)"}'
              >
                ${element}
              </div>
            `;
          }

          rowText += `<div class='row'>${cell}</div>`;
          rank++;
        }

        let container = `<div class='container'>${rowText}</div>`;
        contents += container;
      }

      // Visualize final result
      const wrapper = `<div class='wrapper'>${contents}</div>`;
      document.write(wrapper);
    </script>
  </body>
</html>
